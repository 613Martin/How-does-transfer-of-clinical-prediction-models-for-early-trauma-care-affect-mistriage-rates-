---
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
## LOADING ENVIROMENT
results <- readRDS("./output/original.results.Rds")
## PREPARED CODE SNIPPETS
## Total patients and NA
total.number.of.patients <- nrow(results$data.sets.before.imputations$multi.centre.vs.single.centre$multi.centre)
total.number.of.na <- results$NA.info.sample$multi.centre.vs.single.centre$multi.centre$total.number.of.na
## Sample NA
na.vector <- unlist(results$NA.info.sample)
highest.percent.missing.number <- max(na.vector[na.vector<100])
highest.percent.missing.name <- names((na.vector[na.vector == highest.percent.missing.number]))
## Variable NA
number.variable.na <- max(results$NA.info.variable$multi.centre.vs.single.centre$multi.centre$number.of.na)
percent.variable.na <- results$NA.info.variable$multi.centre.vs.single.centre$multi.centre$percentage[results$NA.info.variable$multi.centre.vs.single.centre$multi.centre$number.of.na == number.variable.na]
name.variable.na <- row.names( results$NA.info.variable$multi.centre.vs.single.centre$multi.centre[results$NA.info.variable$multi.centre.vs.single.centre$multi.centre$number.of.na == number.variable.na,] )
## Development and validation
max.imp <- max(results$original.stats$Total.imputations)
best.validation <- results$original.stats[results$original.stats$Validation.mistriage.median == min(results$original.stats$Validation.mistriage.median),]
## Comparison
best.transfer <- results$original.stats[results$original.stats$Transfer.mistriage.median == min(results$original.stats$Transfer.mistriage.median),]
worst.transfer <- results$original.stats[results$original.stats$Transferred.mistriage.minus.buddy.local.mistriage.median == min(min(results$original.stats$Transferred.mistriage.minus.buddy.local.mistriage.median)),]
## Result tables
result.tables <- readRDS("result.tables.Rds")

```


# Results
We analysed data from `r total.number.of.patients ` trauma patients to investigate the effects of transfer on clinical prediction models (Table 1). The total number of missing observations was `r total.number.of.na ` in the entire study cohort. The sample with the highest percentage of missing observations was the `r highest.percent.missing.name ` sample with `r highest.percent.missing.number `%. The variable with the highest number of missing observations was `r name.variable.na `, with `r number.variable.na ` missing observations, which constituted `r percent.variable.na ` % of the total observations for this variable.

Variable outliers?  
Divergent samples or variables.  
NA for predictors and outcome??  
Table 1 = Sample Characteristics table  

## Development and validation
During model development, the maximum amount of imputations used was `r max.imp`, which is equal to the highest percentage of missing observations. Restricted dubic splines were implemented when modelling sysytolic blood pressure and respiratory rate, in both cases 4 knots were used. Model validation performance was obtained for each model (Table 2).
The sample with the best validation model performance was the `r best.validation$Sample.name` sample with a median mistriage rate of `r best.validation$Validation.mistriage.median` (IQR `r best.validation$Validation.mistriage.lb` - `r best.validation$Validation.mistriage.ub`). Model validation performance in general was good/poor with a median mistriage rate range of `r min(results$original.stats$Validation.mistriage.median)` - `r max(results$original.stats$Validation.mistriage.median)`. 

Imputations  
Shrinkage factor?  
Optimal cut-off?  
RCS for different variables  
Bootstraps?  
Local mistriage values.  
Table 2 = Medians and IQR for validation  

## Comparison
Model performance after transfer was determined in each data set (Table 3). When transferred, the model with the best performance was `r best.transfer$Sample.name` with a median mistriage of `r best.transfer$Transfer.mistriage.median` (IQR `r best.transfer$Transfer.mistriage.lb` - `r best.transfer$Transfer.mistriage.ub`). When transferred model performance was compared to the validation performance in the same sample, the transferred models generally performed worse/better/same than their corresponding local models (Table 4). The highest decline in performance was found in the `r worst.transfer$Sample.name` sample, with a median mistriage difference of `r worst.transfer$Transferred.mistriage.minus.buddy.local.mistriage.median` (IQR `r worst.transfer$Transferred.mistriage.minus.buddy.local.mistriage.lb` - `r worst.transfer$Transferred.mistriage.minus.buddy.local.mistriage.ub`), meaning that this model was the most negativly affected by being transferred. In clinical terms, this model transfer means that among 100 trauma patients, `r abs(worst.transfer$Transferred.mistriage.minus.buddy.local.mistriage.median) * 100` would be wrongly classified as major or minor trauma.

Comparison model performances.  
Most? Less?   
Significance! P-values.  
Table 3 = Medians and IQR for transfer.  
Table 4 = Medians and IQR for the difference in performance

```{r, echo = FALSE, results = "asis"} 
result.tables$high.volume
```






